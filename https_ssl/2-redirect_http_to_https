# HAProxy configuration to redirect HTTP -> HTTPS and serve HTTPS (task 2)
# Replace /etc/letsencrypt/live/www.example.com/haproxy.pem with your actual cert+key PEM

global
    log /dev/log local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

# HTTP frontend: redirect everything to HTTPS (301)
frontend http_front
    bind *:80
    mode http
    # Transparent 301 redirect to the same host but HTTPS
    # This returns a 301 and preserves the host and path
    http-request redirect scheme https code 301

# HTTPS frontend: SSL termination and proxy to backends
frontend https_front
    bind *:443 ssl crt /etc/letsencrypt/live/www.holberton.online/haproxy.pem
    mode http
    option forwardfor
    default_backend web_back

backend web_back
    mode http
    balance roundrobin
    server web-01 13.220.103.184:80 check
    server web-02 3.85.233.7:80 check
