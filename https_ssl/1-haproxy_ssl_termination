# HAProxy configuration for SSL termination on port 443
# Drop this file as /etc/haproxy/haproxy.cfg on the LB (or copy it there via the deploy script)
# Ensure combined PEM exists at: /etc/letsencrypt/live/www.teniola.me/haproxy.pem

global
    log /dev/log local0
    pidfile /run/haproxy.pid
    maxconn 4096
    user haproxy
    group haproxy
    daemon
    tune.ssl.default-dh-param 2048

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000
    option  forwardfor except 127.0.0.0/8

frontend https_front
    bind *:443 ssl crt /etc/letsencrypt/live/www.teniola.me/haproxy.pem
    mode http
    option httplog
    http-request set-header X-Forwarded-Proto https
    default_backend web_back

backend web_back
    mode http
    balance roundrobin
    option httpchk GET /
    http-check expect status 200
    server web-01 13.220.103.184:80 check
    server web-02 3.85.233.7:80 check
